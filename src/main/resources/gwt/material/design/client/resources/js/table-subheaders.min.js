function TableSubHeaders(e,t){TableSubHeaders.id++;var o=this,i=$(o);o.name="subheaders"+TableSubHeaders.id,o.$window=$(window),o.$document=$(document),o.$tableBody=e.find("tbody"),o.$tableParents=e.parents(),o.$stickies=null,o.options=[],o.cache=[],o.loaded=!1,o.scrollBarWidth=13,o.debug={enabled:!1,smartScroll:{table:0,window:0,outer:0},touchmove:{table:0,window:0,outer:0},resize:{table:0,window:0}};var a={marginTop:0,marginLeft:0,scrollThrottle:10,resizeThrottle:100};o.load=function(e){o.options=$.extend({},a,e),o.scrollBarWidth=$.scrollBarWidth(),o.bind(),o.detect(),o.recalculate(!0),o.loaded=!0},o.unload=function(){o.options=[],o.unbind(),o.$stickies.each(function(){var t=$(this);t.removeClass("fixed").removeClass("passed").removeAttr("style"),t.unwrap(),e.scrollTop(0)}),o.loaded=!1},o.reload=function(){o.unload(),o.load()},o.detect=function(){o.$stickies=$(t,e),o.$stickies.off("."+o.name),o.$stickies.on("tap."+o.name+" click."+o.name,function(){o.toggle($(this))});var i=$(t,e).filter(function(){return $(this).parent().is(":not(div)")});i.each(function(){$(this).wrap("<div style='width:100%;z-index:2;cursor:pointer;background-color:#fff;'/>")})},o.bind=function(){o.unbind();var t=o.options.scrollThrottle,i=o.options.resizeThrottle;e.smartScroll(o.name,$.throttle(t,function(e,t){o.debug.enabled&&o.debug.smartScroll.table++,o.scroll(e,t)})),e.on("resize."+o.name,$.debounce(i,function(){o.debug.enabled&&o.resize.table++,o.recalculate(!0)})),o.$window.smartScroll(o.name,$.throttle(t,function(e,t){o.debug.enabled&&o.debug.smartScroll.window++,o.alignment(e,t)})),o.$window.on("resize."+o.name,$.debounce(i,function(){o.debug.enabled&&o.debug.resize.window++,o.recalculate(!0)})),o.detectOuterScrolls()},o.unbind=function(){e.off("."+o.name),o.$window.off("."+o.name),o.$stickies&&o.$stickies.off("."+o.name),o.$tableParents.each(function(){$(this).off("."+o.name)})},o.detectOuterScrolls=function(){var e=o.options.scrollThrottle;o.$tableParents.off("."+o.name),o.$tableParents.filter(function(){return $(this).hasScrollBar()}).smartScroll(o.name,$.throttle(e,function(e,t){o.debug.enabled&&o.debug.smartScroll.outer++,o.alignment(e,t)}))},o.toggle=function(e){e.hasClass("expanded")?o.close(e):o.open(e)},o.open=function(e){e.addClass("expanded"),i.trigger("opening",[e]);var t=e.find("i");if(null!=t){var a=e.attr("data-close-icon");void 0===a&&(a="remove"),t.text(a)}var n=e.parent(),l=n.nextUntil("div","tr");$.when(l.show(200)).then(function(){o.recalculate(!0),e.trigger("opened",[e])})},o.close=function(e){e.removeClass("expanded"),i.trigger("closing",[e]);var t=e.find("i");if(null!=t){var a=e.attr("data-open-icon");void 0===a&&(a="add"),t.text(a)}var n=e.parent().nextUntil("div");$.when(n.hide(200)).then(function(){o.recalculate(!0),e.trigger("closed",[e])})},o.recalculate=function(t){t&&i.trigger("before-recalculate"),o.detectOuterScrolls(),o.updateHeights();var a=e.scrollTop(),n=o.getOuterScrollTop(),l=o.$tableBody.outerWidth();o.$stickies.each(function(){var e=$(this);e.removeClass("fixed").removeClass("passed").removeAttr("style"),$.data(this,"pos",e.offset().top+n+a+1),o.updateWidth(e,l-2)}),t&&i.trigger("after-recalculate"),o.scroll()},o.scroll=function(t,i){var a=e.offset(),n=e.innerWidth(),l=o.$tableBody.outerWidth(),s=a.top+o.options.marginTop,r=e.scrollTop()+o.getOuterScrollTop(),c=o.$window.scrollTop(),d=a.left+o.options.marginLeft,u=e.scrollLeft(),f=o.getOuterScrollLeft();o.$stickies.each(function(e){var t=$(this),a=!1;if(!i||i.isY()){var p=o.$stickies.eq(e+1),h=o.$stickies.eq(e-1),g=$.data(this,"pos");if(r+s>=g)o.emulateYScroll(t,s,c,r),t.hasClass("passed")||(t.hasClass("fixed")||(t.addClass("fixed"),a=i&&!i.isX()),o.updateWidth(t,l),h.css("display","none"),t.css({display:""}),p.length>0&&r+s>=g-h.outerHeight()&&t.addClass("passed"));else{t.outerWidth();t.removeClass("fixed").removeAttr("style"),h.css({display:""}),h.length>0&&r+s<=g-h.outerHeight()&&h.removeClass("passed")}}(!i||i.isX()||a)&&t.hasClass("fixed")&&o.emulateXScroll(t,n,d,u,f)}),o.$stickies.filter(".passed").each(function(e){var t=$(this),i=o.$stickies.eq(e+1),a=$.data(i[0],"pos")-r-t.outerHeight()-c;t.data("push-back",parseInt(t.css("top").replace("px","")-a)),t.css({top:a})})},o.emulateYScroll=function(e,t,i,a,n){var l=e.outerHeight()+50,s=(n?n:o.getOuterScrollTop())-o.options.marginTop,r=s+"px",c=l+"px",d=e.data("clip-right"),u=e.data("clip-left");if(e.hasClass("passed")){var f=e.data("push-back");r=s+f+"px"}e.data("clip-top",r).data("clip-bottom",c),e.css({top:t-i,clip:"rect("+r+", "+d+", "+c+", "+u+")"})},o.emulateXScroll=function(e,t,i,a,n){var l=a+(n?n:o.getOuterScrollLeft())+"px",s=t+a-o.scrollBarWidth+"px",r=e.data("clip-top")||"auto",c=e.data("clip-bottom")||"auto";e.data("clip-left",l).data("clip-right",s),e.css({left:i-a-o.$window.scrollLeft(),clip:"rect("+r+", "+s+", "+c+", "+l+")"})},o.alignment=function(t,i){var a=e.offset(),n=e.innerWidth(),l=o.$tableBody.outerWidth(),s=!i||i.isX(),r=!i||i.isY(),c=r?o.$window.scrollTop():0,d=r?a.top+o.options.marginTop:0,u=r?e.scrollTop()+o.getOuterScrollTop():0,f=s?a.left+o.options.marginLeft:0,p=s?e.scrollLeft():0,h=s?o.getOuterScrollLeft():0;o.$stickies.filter(".fixed").each(function(e){var t=$(this);if(!i||i.isY()){var a=d;if(t.hasClass("passed")){var r=o.$stickies.eq(e+1);a=$.data(r[0],"pos")-u-t.outerHeight()}o.emulateYScroll(t,a,c,u),o.updateWidth(t,l)}s&&o.emulateXScroll(t,n,f,p,h)})},o.getOuterScrollTop=function(){var e=0;return o.$tableParents.filter(":not(body,html)").each(function(){e+=$(this).scrollTop()}),e},o.getOuterScrollLeft=function(){var e=0;return o.$tableParents.filter(":not(body,html)").each(function(){e+=$(this).scrollLeft()}),e},o.updateCellWidths=function(t){var i=o.getCellWidths($("th,td",$("thead",e)));o.setCellWidths(i,t)},o.setCellWidths=function(e,t){t.find("th,td").each(function(t){var o=$(this),i=e[t];o.css({"min-width":i,"max-width":i})})},o.getCellWidths=function(e){var t=[];return e.each(function(e){var i,a=$(this);if("border-box"===a.css("box-sizing"))i=this.getBoundingClientRect().width;else{var n=$("th",o.$originalHeader);if("collapse"===n.css("border-collapse"))if(window.getComputedStyle)i=parseFloat(window.getComputedStyle(this,null).width);else{var l=parseFloat(a.css("padding-left")),s=parseFloat(a.css("padding-right")),r=parseFloat(a.css("border-width"));i=a.outerWidth()-l-s-r}else i=a.width()}t[e]=i}),t},o.updateWidth=function(e){o.updateCellWidths(e)},o.updateWidths=function(){},o.updateHeights=function(){o.$stickies.each(function(){var e=$(this);e.parent().height(e.outerHeight())})},o.setMarginTop=function(e){o.options.marginTop=e},o.setMarginLeft=function(e){o.options.marginLeft=e},o.isLoaded=function(){return o.loaded},o.getDebugInfo=function(){return o.debug}}TableSubHeaders.id=0,TableSubHeaders.newInstance=function(e,t){return new TableSubHeaders(e,t)};
